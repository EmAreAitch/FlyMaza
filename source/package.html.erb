<%# /source/packages/package.html.erb %>

<% content_for :head do %>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TouristTrip",
    "name": "<%= json_escape(package[:title]) %>",
    "description": "<%= json_escape(package[:description]) %>",
    "url": "<%= config[:root_url] %><%= package[:url] %>",
    "image": "<%= config[:root_url] %><%= responsive_image(package[:hero]) %>",
    "provider": {
      "@type": "TravelAgency",
      "name": "FlyMaza",
      "url": "<%= config[:root_url] %>"
    },
    "offers": {
      "@type": "Offer",
      "price": "<%= package[:price] %>",
      "priceCurrency": "INR",
      "availability": "https://schema.org/InStock"
    },
    "duration": "P<%= package[:days] %>D",
    "itinerary": {
      "@type": "ItemList",
      "itemListElement": [
        <% if package[:itinerary] %>
          <% package[:itinerary].each_with_index do |day, index| %>
          {
            "@type": "ListItem",
            "position": <%= index + 1 %>,
            "name": "Day <%= index + 1 %>",
            "description": "<%= json_escape(day) %>"
          }<%= ',' unless index == package[:itinerary].length - 1 %>
          <% end %>
        <% end %>
      ]
    }
  }
  </script>
<% end %>

<%# Hero Section %>
<% pkg_hero_url = responsive_image(package[:hero], w: 1920, h: 1080) %>
<section class="relative h-[90dvh] bg-cover bg-center" style="background-image: url('<%= pkg_hero_url %>')">
  <div class="absolute inset-0 gradient-overlay"></div>
  <div class="absolute bottom-0 w-full h-24 bg-gradient-to-t from-black/60 to-transparent"></div>
  <div class="container-custom relative z-10 h-full flex flex-col justify-center">
    <h1 class="heading-hero text-white drop-shadow-lg"><%= package[:title] %></h1>
    <p class="mt-4 text-lg md:text-xl text-white/80 drop-shadow">
      <%= package[:days] %> Days / <%= package[:nights] %> Nights —
      Starting from <span class="text-golden-400 font-bold">₹<%= package[:price] %></span> per person
    </p>
  </div>
</section>

<%# About Section %>
<section class="section-spacing relative" style="background: linear-gradient(to right, #f0f4ff, #e0e8ff);">
  <div class="container-custom">
    <div class="grid lg:grid-cols-3 gap-12">
      <div class="lg:col-span-2">
        <h2 class="heading-section text-gray-900 mb-6">About This Package</h2>
        <p class="text-lg text-gray-700 leading-relaxed"><%= package[:description] %></p>
      </div>
      <div>
        <%# Quick Info %>
        <div class="bg-white/30 backdrop-blur-xl rounded-2xl shadow-card p-6 border border-white/20">
          <h3 class="heading-card mb-4 text-primary-600">Quick Info</h3>
          <ul class="space-y-3 text-gray-900">
            <li><strong>Destination:</strong> <%= destination_name %></li>
            <li><strong>Duration:</strong> <%= package[:days] %>D / <%= package[:nights] %>N</li>
            <li><strong>Starting from:</strong> ₹<%= package[:price] %> per person</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<%# Highlights Section %>
<section class="section-spacing bg-gray-50">
  <div class="container-custom">
    <h2 class="heading-section text-center text-gray-900 mb-12">Highlights</h2>
    <div class="grid md:grid-cols-2 gap-8">
      <% package[:highlights].each_with_index do |highlight, i| %>
        <div class="relative overflow-hidden rounded-xl p-8 shadow-card card-hover
                    <%= i.even? ? 'bg-gradient-to-br from-primary-600 to-accent-500' : 'bg-gradient-to-br from-secondary-500 to-golden-500' %>">
          <div class="absolute inset-0 bg-black/20"></div>
          <p class="relative z-10 text-white font-semibold"><%= highlight %></p>
        </div>
      <% end %>
    </div>
  </div>
</section>

<%# Itinerary Section (Timeline Style) %>
<section class="section-spacing bg-gray-50">
  <div class="container-custom">
    <div class="text-center mb-16 fade-in">
      <p class="text-gray-500 text-lg mb-4">Your Luxury Journey</p>
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
        Day-by-Day Itinerary
      </h2>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        Explore Paris in style with a carefully crafted journey blending culture, gastronomy, and elegance.
      </p>
    </div>
    <div class="max-w-4xl mx-auto">
      <div class="space-y-12">
        <% package[:itinerary].each_with_index do |day, index| %>
          <div class="relative fade-in">
            <% unless index == package[:itinerary].length - 1 %>
              <div class="absolute left-8 top-16 w-0.5 h-20 bg-gray-200"></div>
            <% end %>
            <div class="flex items-start space-x-8">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-primary-600 text-white rounded-full flex items-center justify-center font-bold text-lg shadow-lg">
                  <%= index + 1 %>
                </div>
              </div>
              <div class="bg-white rounded-2xl shadow-sm border border-gray-100 flex-1 overflow-hidden">
                <div class="p-8 cursor-pointer hover:bg-gray-50 transition-colors collapsible-header" data-target="day-<%= index %>">
                  <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold text-gray-900"><%= day[:title] %></h3>                    
                    <svg class="size-5 shrink-0 text-gray-500 transition-transform duration-200 collapsible-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
                <div id="day-<%= index %>" class="max-h-0 overflow-hidden transition-[max-height] duration-300 collapsible-content">
                  <div class="px-8 pb-8">
                    <p class="text-gray-600 leading-relaxed text-lg"><%= day[:details] %></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>

<%# Inclusions & Exclusions Section %>
<section class="section-spacing relative">
  <div class="absolute inset-0 bg-gradient-to-r from-primary-50 to-secondary-50"></div>
  <div class="container-custom relative z-10 grid md:grid-cols-2 gap-12">
    <div class="bg-white/60 backdrop-blur-md rounded-xl shadow-card p-8 border border-white/20">
      <h2 class="heading-card text-primary-700 mb-6">Inclusions</h2>
      <ul class="space-y-3">
        <% package[:inclusions].each do |inc| %>
          <li class="flex items-start gap-3 text-gray-800">
            <span class="w-6 h-6 flex-shrink-0 bg-primary-600 text-white rounded-full flex items-center justify-center">✓</span>
            <%= inc %>
          </li>
        <% end %>
      </ul>
    </div>
    <div class="bg-white/60 backdrop-blur-md rounded-xl shadow-card p-8 border border-white/20">
      <h2 class="heading-card text-secondary-700 mb-6">Exclusions</h2>
      <ul class="space-y-3">
        <% package[:exclusions].each do |exc| %>
          <li class="flex items-start gap-3 text-gray-800">
            <span class="w-6 h-6 flex-shrink-0 bg-secondary-500 text-white rounded-full flex items-center justify-center">✗</span>
            <%= exc %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</section>

<% if package.gallery.present? %>
  <section class="section-spacing bg-gray-50">
      <div class="container-custom">
        <div class="mb-12 text-center">
          <h2 class="heading-section text-gray-900">Gallery</h2>
          <p class="text-gray-600">A glimpse of the beauty you'll experience.</p>
        </div>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <% package.gallery.each do |image| %>
            <div class="rounded-2xl overflow-hidden shadow-card">
              <%= responsive_image_tag(image, mobile_w: 600, desktop_w: 800, h: 600, alt: "#{destination_name} gallery image", css_class: "w-full h-64 object-cover", sizes: "(max-width: 767px) 100vw, (max-width: 1023px) 50vw, 33vw") %>
            </div>
          <% end %>
        </div>
      </div>
    </section>
<% end %>

<!-- Testimonial Section -->
<%= partial "testimonials" %>

<%# CTA Section %>
<section class="py-32 bg-primary-600">
  <div class="container-custom px-4 text-center">
    <div class="inline-block bg-white/20 backdrop-blur-lg rounded-2xl p-12 shadow-card border border-white/30">
      <h2 class="heading-section text-white mb-4">Ready for Your Next Adventure?</h2>
      <p class="text-white/80 mb-8">Book "<%= package[:title] %>" today and enjoy a once-in-a-lifetime trip to <%= destination_name %>.</p>
      <a href="/#contact" class="btn-secondary">Book Now</a>
    </div>
  </div>
</section>
